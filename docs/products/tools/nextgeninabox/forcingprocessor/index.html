<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-products/tools/nextgeninabox/forcingprocessor" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Forcing Processor | CIROH DocuHub</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://ciroh.org/docs/products/tools/nextgeninabox/forcingprocessor"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Forcing Processor | CIROH DocuHub"><meta data-rh="true" name="description" content="NextGen Forcing Processor"><meta data-rh="true" property="og:description" content="NextGen Forcing Processor"><link data-rh="true" rel="icon" href="/img/docuhub-logo.png"><link data-rh="true" rel="canonical" href="http://ciroh.org/docs/products/tools/nextgeninabox/forcingprocessor"><link data-rh="true" rel="alternate" href="http://ciroh.org/docs/products/tools/nextgeninabox/forcingprocessor" hreflang="en"><link data-rh="true" rel="alternate" href="http://ciroh.org/docs/products/tools/nextgeninabox/forcingprocessor" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CIROH DocuHub RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CIROH DocuHub Atom Feed"><link rel="stylesheet" href="/assets/css/styles.56efd528.css">
<script src="/assets/js/runtime~main.bfdb2f53.js" defer="defer"></script>
<script src="/assets/js/main.608d9f45.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_gu5v" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/docuhub-logo.png" alt="CIROH Logo" class="themedComponent_ZRzL themedComponent--light_dGsa"><img src="/img/docuhub-logo.png" alt="CIROH Logo" class="themedComponent_ZRzL themedComponent--dark_pzCA"></div><b class="navbar__title text--truncate">CIROH DocuHub</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/products/intro">Products</a><a class="navbar__item navbar__link" href="/docs/services/intro">Services</a><a class="navbar__item navbar__link" href="/docs/education/">Education</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/about">About us</a><div class="toggle_kWbt colorModeToggle_GwZs"><button class="clean-btn toggleButton_fOL9 toggleButtonDisabled_STpu" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_DCeJ"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_DFgp"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_IP3a"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_IbdI"><div class="docsWrapper_JGIH"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_SdI4" type="button"></button><div class="docRoot_eRbX"><aside class="theme-doc-sidebar-container docSidebarContainer_Ta75"><div class="sidebarViewport_fgog"><div class="sidebar_oDHW"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_vPEQ"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/products/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/products">Products</a><button aria-label="Collapse sidebar category &#x27;Products&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/nextgen-in-a-box-ngiab">NextGen In A Box (NGIAB)</a><button aria-label="Collapse sidebar category &#x27;NextGen In A Box (NGIAB)&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/products/tools/nextgeninabox/ngiab-intro">Introduction and How tos?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/products/tools/nextgeninabox/nextgenDatastream">NextGen Datastream</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/products/tools/nextgeninabox/forcingprocessor">Forcing Processor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/products/tools/nextgeninabox/Conference Material">Conference Material</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/products/tools/nextgeninabox/news">News</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/data-access">Data Access</a><button aria-label="Expand sidebar category &#x27;Data Access&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/water-node">Water Node</a><button aria-label="Expand sidebar category &#x27;Water Node&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/roset">ROSET</a><button aria-label="Expand sidebar category &#x27;ROSET&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/rti-teehr">RTI TEEHR</a><button aria-label="Expand sidebar category &#x27;RTI TEEHR&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/netwa">NETWA</a><button aria-label="Expand sidebar category &#x27;NETWA&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/tethys">TETHYS</a><button aria-label="Expand sidebar category &#x27;TETHYS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/national-snow-model">National Snow Model</a><button aria-label="Expand sidebar category &#x27;National Snow Model&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/hydroserver">HydroServer</a><button aria-label="Expand sidebar category &#x27;HydroServer&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_lg0V"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_nDJs"><div class="docItemContainer_OGiL"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_k3Z9" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JACu"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/products"><span itemprop="name">Products</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/nextgen-in-a-box-ngiab"><span itemprop="name">NextGen In A Box (NGIAB)</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Forcing Processor</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_QCOD theme-doc-toc-mobile tocMobile_N0YI"><button type="button" class="clean-btn tocCollapsibleButton_pHwF">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Forcing Processor</h1>
<p>Forcingprocessor converts National Water Model (NWM) forcing data into Next Generation National Water Model (ngen) forcing data. The motivation for this tool is NWM data is gridded and stored within netCDFs for each forecast hour. Ngen inputs this same forcing data, but in the format of per-catchment csv files that hold time series data. Forcingprocessor is driven by a configuration file that is explained, with an example, in detail below. The config argument accepts an s3 URL.</p>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="install">Install<a href="#install" class="hash-link" aria-label="Direct link to Install" title="Direct link to Install">​</a></h2>
<div class="codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-text codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">pip install -r /ngen-datastream/forcingprocessor/requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pip install -e /ngen-datastream/forcingprocessor</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="run-the-forcingprocessor">Run the forcingprocessor<a href="#run-the-forcingprocessor" class="hash-link" aria-label="Direct link to Run the forcingprocessor" title="Direct link to Run the forcingprocessor">​</a></h2>
<div class="codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-text codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">python forcingprocessor.py conf.json</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See the docker README for example run commands from the container.</p>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="run-notes">Run Notes<a href="#run-notes" class="hash-link" aria-label="Direct link to Run Notes" title="Direct link to Run Notes">​</a></h2>
<p>This tool is CPU, memory, and I/O intensive. For the best performance, run with <code>proc_threads</code> equal to than half of available cores and <code>write_threads</code> equal to the number of available cores. Best to experiment with your resources to find out what works best. These options default to 80% and 100% available cores respectively.</p>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="nwm_file">nwm_file<a href="#nwm_file" class="hash-link" aria-label="Direct link to nwm_file" title="Direct link to nwm_file">​</a></h2>
<p>A text file given to forcingprocessor that contains each nwm forcing file name. These can be URLs or local paths. This file can be generated with the <a href="https://github.com/CIROH-UA/nwmurl" target="_blank" rel="noopener noreferrer">nwmurl tool</a> and a <a href="https://github.com/CIROH-UA/ngen-datastream/tree/main/forcingprocessor/nwm_filenames_generator.py" target="_blank" rel="noopener noreferrer">generator script</a> that has been provided within this repo. The config argument accepts an s3 URL.</p>
<div class="codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-text codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">python nwm_filenames_generator.py conf_nwm_files.json</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>An example configuration file:</p>
<div class="codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-text codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;forcing_type&quot; : &quot;operational_archive&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;start_date&quot;   : &quot;202310300000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;end_date&quot;     : &quot;202310300000&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;runinput&quot;     : 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;varinput&quot;     : 5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;geoinput&quot;     : 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;meminput&quot;     : 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;urlbaseinput&quot; : 7,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;fcst_cycle&quot;   : [0],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &quot;lead_time&quot;    : [1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="weight_file">weight_file<a href="#weight_file" class="hash-link" aria-label="Direct link to weight_file" title="Direct link to weight_file">​</a></h2>
<p>In order to retrieve forcing data from a NWM grid for a given catchment, the indices (weights) of that catchment must be provided to the forcingprocessor in the weights file. The script will ingest every set of catchment weights and produce a corresponding forcings file. These weights can be generated manually from a geopackage <a href="https://noaa-owp.github.io/hydrofabric/articles/data_access.html" target="_blank" rel="noopener noreferrer">https://noaa-owp.github.io/hydrofabric/articles/data_access.html</a> with the <a href="https://github.com/CIROH-UA/ngen-datastream/tree/main/forcingprocessor/weight_generator.py" target="_blank" rel="noopener noreferrer">weight generator</a>. Also, tools are available to help with this in the TEEHR repo <a href="https://github.com/RTIInternational/teehr/tree/main" target="_blank" rel="noopener noreferrer">https://github.com/RTIInternational/teehr/tree/main</a>. An example weight file has been provided <a href="https://github.com/CIROH-UA/ngen-datastream/tree/main/forcingprocessor/data/weights" target="_blank" rel="noopener noreferrer">here</a>. An example nwm forcing file can be found within the this <a href="https://noaa-nwm-pds.s3.amazonaws.com/index.html" target="_blank" rel="noopener noreferrer">NOAA AWS bucket</a>. forcing_short_range was used during development.</p>
<div class="codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-text codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">python weight_generator.py &lt;path to geopackage&gt; &lt;path to output weights to&gt; &lt;path to example NWM forcing file&gt;</span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The weight generator will input an example NWM forcing netcdf to reference the NWM grid, a geopackage that contains all of the catchments the user wants weights for, and a file name for the weight file. Subsetted geopackages can be made with <a href="https://github.com/CIROH-UA/ngen-datastream/tree/main/subsetting" target="_blank" rel="noopener noreferrer">subsetting</a></p>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="configuration-sections">Configuration Sections<a href="#configuration-sections" class="hash-link" aria-label="Direct link to Configuration Sections" title="Direct link to Configuration Sections">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="1-forcing">1. Forcing<a href="#1-forcing" class="hash-link" aria-label="Direct link to 1. Forcing" title="Direct link to 1. Forcing">​</a></h3>
<table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>start_time</td><td>Datetime of first nwm file (YYYYMMDDHHMM)</td></tr><tr><td>end_time</td><td>Datetime of last nwm file  (YYYYMMDDHHMM)</td></tr><tr><td>nwm_file</td><td>Path to a text file containing nwm file names. One filename per line. Any *input options</td></tr><tr><td>weight_file</td><td>Weight file for the run. Accepts local absolute path, s3 URI or URL</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="2-storage">2. Storage<a href="#2-storage" class="hash-link" aria-label="Direct link to 2. Storage" title="Direct link to 2. Storage">​</a></h3>
<table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>storage_type</td><td>Type of storage (local or s3)</td></tr><tr><td>output_bucket</td><td>If storage_type = s3: output bucket for output, If storage_type = local: appened to output_path</td></tr><tr><td>output_path</td><td>If storage_type = s3: prefix for output, If storage_type = local: absolute path for output, will default to cwd/date if left blank</td></tr><tr><td>output_file_type</td><td>Output file type (e.g., csv, parquet)</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_FNw8" id="3-run">3. Run<a href="#3-run" class="hash-link" aria-label="Direct link to 3. Run" title="Direct link to 3. Run">​</a></h3>
<table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>verbose</td><td>Verbosity of the run</td></tr><tr><td>collect_stats</td><td>Collect forcing metadata</td></tr><tr><td>proc_threads</td><td>Number of data processing threads, defaults to 80% available cores</td></tr><tr><td>write_threads</td><td>Number of writing threads, defaults to 100% available cores</td></tr><tr><td>nfile_chunk</td><td>Number of files to process each write, set to greater than the number of nwm files unless memory constraints are reached, defaults to 1000000. Only set this if experiencing memory constraints due to large number of nwm forcing files</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_FNw8" id="example-configuration">Example Configuration<a href="#example-configuration" class="hash-link" aria-label="Direct link to Example Configuration" title="Direct link to Example Configuration">​</a></h2>
<div class="codeBlockContainer_aalF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_MHx8"><pre tabindex="0" class="prism-code language-text codeBlock_zHgq thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_RjmQ"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;forcing&quot;  : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;start_date    : &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;end_date&quot;     : &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;nwm_file&quot;     : &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;weight_file&quot;  : &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;storage&quot;:{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;storage_type&quot;     : &quot;local&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;output_bucket&quot;    : &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;output_path&quot;      : &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;output_file_type&quot; : &quot;csv&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;run&quot; : {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;verbose&quot;       : true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;collect_stats&quot; : true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_Sd8_"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_LnQD" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_t3l1"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_IiZV"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-tags-row row margin-bottom--sm"><div class="col"><b>Tags:</b><ul class="tags_aHIs padding--none margin-left--sm"><li class="tag_nwHU"><a class="tag_QDqo tagRegular_RTiO" href="/docs/tags/forcings">forcings</a></li></ul></div></div><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/CIROH-UA/ciroh-ua_website/edit/main/docs/products/tools/nextgeninabox/forcingprocessor.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_NulP" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated__GQF"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/products/tools/nextgeninabox/nextgenDatastream"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">NextGen Datastream</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/products/tools/nextgeninabox/Conference Material"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Conference Material</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_IS5x thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#install" class="table-of-contents__link toc-highlight">Install</a></li><li><a href="#run-the-forcingprocessor" class="table-of-contents__link toc-highlight">Run the forcingprocessor</a></li><li><a href="#run-notes" class="table-of-contents__link toc-highlight">Run Notes</a></li><li><a href="#nwm_file" class="table-of-contents__link toc-highlight">nwm_file</a></li><li><a href="#weight_file" class="table-of-contents__link toc-highlight">weight_file</a></li><li><a href="#configuration-sections" class="table-of-contents__link toc-highlight">Configuration Sections</a><ul><li><a href="#1-forcing" class="table-of-contents__link toc-highlight">1. Forcing</a></li><li><a href="#2-storage" class="table-of-contents__link toc-highlight">2. Storage</a></li><li><a href="#3-run" class="table-of-contents__link toc-highlight">3. Run</a></li></ul></li><li><a href="#example-configuration" class="table-of-contents__link toc-highlight">Example Configuration</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/about">About CIROH</a></li><li class="footer__item"><a href="https://ciroh.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Visit ciroh.org<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_T11m"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Follow us on</div><ul class="footer__items clean-list"><li class="footer__item">
                <a href="https://ciroh.org" target="_blank" rel="noreferrer noopener" aria-label="Visit CIROH" style="margin-left:-15px">
                <img src="https://static.vecteezy.com/system/resources/previews/018/930/572/non_2x/youtube-logo-youtube-icon-transparent-free-png.png" alt="CIROH on YouTube" width="70" height="60">
              </a>
              <a href="https://ciroh.org" target="_blank" rel="noreferrer noopener" aria-label="Visit CIROH" style="margin-left:-15px">
                <img src="https://static.vecteezy.com/system/resources/previews/018/930/587/non_2x/linkedin-logo-linkedin-icon-transparent-free-png.png" alt="CIROH on LinkedIn" width="70" height="60">
              </a>
              <a href="https://ciroh.org" target="_blank" rel="noreferrer noopener" aria-label="Visit CIROH" style="margin-left:-25px">
                <img src="https://static.vecteezy.com/system/resources/previews/018/930/702/original/facebook-logo-facebook-icon-transparent-free-png.png" alt="CIROH on Facebook" width="70" height="60">
              </a> 
                  
                </li><li class="footer__item">
                <a href="https://ciroh.org" target="_blank" rel="noreferrer noopener" aria-label="Visit CIROH" style="margin-left:0px;">
                <img src="https://static.vecteezy.com/system/resources/previews/023/986/555/original/instagram-logo-instagram-logo-transparent-instagram-icon-transparent-free-free-png.png" alt="CIROH on Instagram" width="45" height="45">
              </a>
              <a href="https://ciroh.org" target="_blank" rel="noreferrer noopener" aria-label="Visit CIROH" style="margin-left:5px;">
                <img src="https://seeklogo.com/images/T/twitter-x-logo-0339F999CF-seeklogo.com.png?v=638264860180000000" alt="CIROH on X" width="40" height="40">
              </a>
              <a href="https://ciroh.org" target="_blank" rel="noreferrer noopener" aria-label="Visit CIROH" style="margin-left:5px;">
                <img src="https://cdn4.iconfinder.com/data/icons/iconsimple-logotypes/512/github-512.png" alt="CIROH on GitHUb" width="40" height="40">
              </a>
                
                </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 CIROH - The University of Alabama</div></div></div></footer></div>
</body>
</html>